-- overview
-- split input into x,y,seated -> no seat = null, empty = 0, full = 1
-- probably need to use x*length+y
-- precompute who can see what 
-- recurse!

-- small dataset
select * from day11_s_data;
/*
1	L##
2	L##
3	L.L
*/

create or replace view day11_xy as
with t (id, y, x, seat, leftover, row_length) as (
  select
    lineno id
    , lineno y
    , 1 x
    , decode( substr(xline,1,1), 'L',0,'#',1,'.',null) seat
    , substr(xline,2) leftover
    ,length(xline) row_length
  from day11_s_data
  union all
  select 
    x*row_length + y id
    , y y
    , x+1 x
    , decode( substr(leftover,1,1), 'L',0,'#',1,'.',null) seat
    , substr(leftover,2) leftover
    , row_length row_length
  from t
  where x < row_length
)
select id,x,y,seat,row_length from t
;

select * from day11_xy;


create or replace function find_first_seat_location(currentid number, stepx number, stepy number) return number as
begin
  null;
end;
/
